Руководство: Многопоточный парсинг данных с Wildberries
Этот проект представляет собой Python-скрипт для автоматизированного сбора (парсинга) информации о товарах с веб-сайта Wildberries по списку артикулов. Скрипт использует комбинацию библиотек Selenium и Beautiful Soup для работы с динамическим содержимым страниц и реализован с использованием многопоточности для ускорения процесса.

Возможности
Чтение списка артикулов из Excel-файла.
Автоматическое посещение страницы каждого товара на Wildberries.
Работа с динамическим содержимым сайта (загрузка данных JavaScript'ом).
Имитация действий пользователя (прокрутка страницы, клик по кнопке "Характеристики и описание").
Извлечение различных данных о товаре: название, цена, описание, характеристики, рейтинг, количество отзывов, цвета, размеры, акции, статус наличия.
Обработка потенциальных страниц проверки/ошибок, прерывающихся загрузок.
Многопоточная обработка артикулов для повышения производительности.
Сохранение собранных данных в новый Excel-файл.
Ведение подробного лога выполнения.
Требования
Для запуска скрипта вам потребуется установить следующее:

Python 3.6+: Скачайте и установите с официального сайта.
pip: Утилита для установки пакетов Python (обычно поставляется вместе с Python).
Веб-браузер Google Chrome: Selenium WebDriver для Chrome требует установленного браузера Chrome.
Необходимые библиотеки Python: Устанавливаются с помощью pip (см. раздел Установка).
Установка
Клонируйте репозиторий или скачайте файлы проекта: Если у вас нет репозитория, создайте папку для проекта и поместите в нее файл со скриптом (.py).
Создайте виртуальное окружение (рекомендуется): Это хорошая практика для управления зависимостями проектов. Откройте терминал/командную строку в папке проекта и выполните:
Bash

python -m venv .venv
Активируйте виртуальное окружение:
На Windows:
Bash

.venv\Scripts\activate
На macOS/Linux:
Bash

source .venv/bin/activate
Установите необходимые библиотеки: В активированном виртуальном окружении выполните:
Bash

pip install selenium beautifulsoup4 pandas webdriver-manager openpyxl
Использование
Подготовьте входной файл: Создайте Excel-файл с именем articles.xlsx в корневой директории проекта. В этом файле должна быть как минимум одна колонка с заголовком Артикул, содержащая список артикулов товаров Wildberries для парсинга.
| Артикул    |
|------------|
| 123456789  |
| 987654321  |
| 112233445  |
| ...        |
Запустите скрипт: Убедитесь, что вы находитесь в терминале/командной строке в директории проекта и виртуальное окружение активировано (если использовали). Выполните команду:
Bash

python ваш_файл_скрипта.py
Замените ваш_файл_скрипта.py на имя файла, в который вы сохранили код.
Наблюдайте за выполнением: Скрипт будет выводить информацию о ходе выполнения в консоль. Более подробные логи будут записываться в файл parser.log.
Получите результаты: После завершения работы скрипт создаст новый Excel-файл с именем, содержащим дату и время запуска (например, wildberries_data_YYYY-MM-DD_HH-MM.xlsx), в той же директории. Этот файл будет содержать спарсенные данные.
Структура кода и пояснения
Скрипт состоит из нескольких основных частей и функций:

Импорт библиотек: В начале скрипта импортируются все необходимые модули (selenium, beautifulsoup4, pandas, concurrent.futures, logging и другие).
Настройка логирования: Конфигурируется система логирования для вывода сообщений в консоль и сохранения их в файл parser.log. Это крайне полезно для отслеживания работы скрипта и отладки.
get_driver() функция:
Отвечает за инициализацию и настройку экземпляра Selenium WebDriver (для Chrome).
Использует webdriver_manager для автоматического скачивания и управления совместимым ChromeDriver'ом.
Устанавливает опции браузера, такие как --headless (запуск без видимого окна, ускоряет работу), --user-agent (имитация обычного браузера) и другие оптимизации.
Возвращает готовый к использованию объект драйвера.
Вспомогательные функции парсинга (parse_name, parse_price, parse_description, parse_product_params_dict, и т.д.):
Это отдельные небольшие функции, каждая из которых специализируется на извлечении конкретного типа данных (названия, цены, описания, характеристик) из объекта BeautifulSoup.
Они принимают на вход объект BeautifulSoup (который содержит HTML страницы).
Используют CSS-селекторы (soup.select_one(), soup.find_all()) для поиска нужных HTML-элементов на странице. CSS-селекторы - это "адреса" элементов в структуре HTML.
Извлекают текстовое содержимое найденных элементов (.text.strip()).
Если нужный элемент не найден (например, из-за отсутствия данных на странице), функции возвращают предопределенные значения по умолчанию (например, 'Нет данных').
Функция parse_product_params_dict содержит логику для парсинга данных из таблиц характеристик.
parse_wildberries_article(article) функция:
Это ключевая функция, которая выполняет весь процесс парсинга для ОДНОГО артикула.
Формирует URL страницы товара на Wildberries.
Инициализирует словарь result со всеми ожидаемыми полями и значениями по умолчанию ('Нет данных', '0', 'Нет акций'). Это гарантирует, что в финальном файле всегда будут все колонки, даже если какие-то данные не удалось получить.
Получает экземпляр WebDriver с помощью get_driver() и открывает URL товара (driver.get(url)).
Выполняет начальную прокрутку страницы (driver.execute_script) для загрузки контента, который подгружается при скролле.
ВАЖНЫЙ ШАГ (Обработка страниц проверки): Добавлен блок проверки наличия ключевых элементов страницы товара (заголовка товара или кнопки описания) с коротким таймаутом. Если ни один из этих элементов не становится видимым в течение таймаута, скрипт предполагает, что загрузилась не страница товара (например, страница проверки или ошибка), логирует предупреждение и пропускает дальнейший детальный парсинг для этого артикула. Функция завершается, возвращая словарь с дефолтными значениями.
Взаимодействие для получения описания: Если ключевые элементы найдены, скрипт переходит к блоку, который пытается найти кнопку "Характеристики и описание", прокрутить ее в видимую область (execute_script("arguments[0].scrollIntoView(true);", ...)), дождаться, пока она станет кликабельной (EC.element_to_be_clickable), и кликнуть по ней.
Ожидание описания: После клика скрипт ждет, пока блок с текстом описания станет видимым (EC.visibility_of_element_located), что подтверждает успешное открытие блока.
Получает актуальный HTML-код страницы после всех взаимодействий (driver.page_source).
Создает объект BeautifulSoup из полученного HTML.
Вызывает вспомогательные функции парсинга для извлечения всех необходимых данных из BeautifulSoup.
Реализована обработка исключений (try...except) на различных этапах для устойчивости скрипта.
Блок finally гарантирует закрытие браузера (driver.quit()) для каждого артикула, даже если произошла ошибка.
Возвращает словарь с собранными данными.
main() функция:
Точка входа в основную логику скрипта.
Определяет имя входного файла (articles.xlsx) и максимальное количество потоков (max_workers).
Читает артикулы из входного файла Excel с помощью Pandas.
Использует concurrent.futures.ThreadPoolExecutor для создания пула потоков и запуска функции parse_wildberries_article для каждого артикула в отдельном потоке.
С помощью as_completed собирает результаты по мере завершения потоков.
Собирает все полученные словари данных в один список.
Обрабатывает возможные ошибки, возникшие в отдельных потоках.
Формирует имя выходного файла с текущей датой и временем.
Преобразует список словарей в DataFrame Pandas с помощью pd.json_normalize.
Заполняет пустые значения в DataFrame значением 'Нет данных' для единообразия.
Сохраняет DataFrame в выходной Excel-файл (.xlsx) с помощью df_result.to_excel().
Логирует информацию о завершении процесса и статистику.
Точка запуска (if __name__ == '__main__':): Стандартная конструкция Python, обеспечивающая запуск функции main() при непосредственном выполнении скрипта.
Возможные проблемы и отладка
Страница проверки/ошибки: Если в логах вы видите сообщение Не удалось найти ключевые элементы страницы товара в течение таймаута..., это означает, что скрипт, вероятно, столкнулся со страницей проверки от Wildberries или другой нестандартной страницей. Текущий скрипт умеет это распознавать и пропускать такие артикулы. Обход таких проверок может быть сложной задачей.
Изменения на сайте: Если Wildberries изменит структуру HTML или CSS-классы, используемые в селекторах (h1.product-page__title, button.j-details-btn-desktop, section.product-details__description.option p.option__text и другие), скрипт перестанет находить элементы. Вам нужно будет вручную открыть страницу товара в браузере, использовать инструменты разработчика (F12) для проверки актуальных селекторов и обновить их в коде.
Таймауты: При нестабильном интернет-соединении или высокой нагрузке на сайт таймауты (10, 15, 20 секунд) могут срабатывать слишком рано. Можно попробовать увеличить их в коде, но чрезмерное увеличение может замедлить парсинг.
Отладка с видимым браузером: Если скрипт выдает ошибки или не получает данные для определенных артикулов, закомментируйте строку options.add_argument('--headless') в функции get_driver(). Это позволит увидеть, что происходит в браузере во время обработки проблемных артикулов. Вы увидите, загружается ли страница, появляются ли нужные элементы, происходят ли клики. Это даст ценную визуальную информацию.